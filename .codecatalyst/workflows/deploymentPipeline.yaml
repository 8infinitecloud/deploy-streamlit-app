Name: streamlitDeploymentPipeline
SchemaVersion: "1.0"

Triggers:
  - Type: PUSH
    Branches:
      - main

Actions:
  InstallDependencies:
    Identifier: aws/build@v1.0.0
    Timeout: 10
    Compute:
      Type: EC2
      Fleet: Linux.x86-64.Large
    Configuration:
      ProjectName: "install-dependencies"
      AWSRegion: "us-east-1"
    Inputs:
      Sources:
        - WorkflowSource

  CDKBootstrap:
    Identifier: aws/cdk-bootstrap@v2.0.1
    Timeout: 10
    Compute:
      Type: EC2
      Fleet: Linux.x86-64.Large
    Inputs:
      Sources:
        - WorkflowSource
    Configuration:
      Region: us-east-1
    Environment:
      Name: default_environment
      Connections:
        - Name: "536697236057"
          Role: CodeCatalystWorkflowDevelopmentRole-streamlit

  CDKDeploy:
    Identifier: aws/cdk-deploy@v2.0.2
    DependsOn:
      - InstallDependencies
      - CDKBootstrap
    Timeout: 15
    Inputs:
      Sources:
        - WorkflowSource
    Configuration:
      StackName: streamlit-app-stack
      Region: us-east-1
      Context: '{"stack_name": "streamlit-app-stack"}'
    Environment:
      Name: default_environment
      Connections:
        - Name: "536697236057"
          Role: CodeCatalystWorkflowDevelopmentRole-streamlit
    Outputs:
      Artifacts:
        - Name: CDKDeploymentOutput
          Files:
            - cdk.out/*

  PostDeploy:
    Identifier: aws/build@v1.0.0
    DependsOn:
      - CDKDeploy
    Timeout: 5
    Compute:
      Type: EC2
      Fleet: Linux.x86-64.Large
    Configuration:
      ProjectName: "post-deploy"
      AWSRegion: "us-east-1"
    Inputs:
      Sources:
        - WorkflowSource
